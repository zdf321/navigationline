{"version":3,"file":"useUserLogin.a921a5f0.js","sources":["../../src/views/login/useLogin.ts","../../src/layout/default/header/components/user-dropdown/unauth.vue","../../src/layout/default/header/components/user-dropdown/user.vue","../../src/hooks/components/useUserLogin.ts"],"sourcesContent":["import { ref, computed, unref, Ref } from 'vue'\n\nexport enum LoginStateEnum {\n\tLOGIN,\n\tREGISTER,\n\tRESET_PASSWORD,\n\tMOBILE,\n\tQR_CODE\n}\n\nconst currentState = ref<LoginStateEnum>(LoginStateEnum.LOGIN)\n\nexport function useLoginState() {\n\tfunction setLoginState(state: LoginStateEnum) {\n\t\tcurrentState.value = state\n\t}\n\n\tconst getLoginState = computed(() => unref(currentState))\n\n\tfunction handleBackLogin() {\n\t\tsetLoginState(LoginStateEnum.LOGIN)\n\t}\n\n\treturn {\n\t\tsetLoginState,\n\t\tgetLoginState,\n\t\thandleBackLogin\n\t}\n}\n\nexport function useFormValid<T extends Object = any>(formRef: Ref<any>) {\n\tasync function validForm() {\n\t\tconst form = unref(formRef)\n\t\tif (!form) return\n\t\tconst data = await form.validate()\n\t\treturn data as T\n\t}\n\n\treturn { validForm }\n}\n\n// @ts-ignore\nexport function useFormRules(formData?: Recordable) {\n\tconst getPasswordFormRule = computed(() => createRule('请输入密码'))\n\tconst getPasswordFormRegRule = computed(() => createPasswordRule())\n\tconst getCodeFormRule = computed(() => createRule('请输入验证码'))\n\tconst getMobileFormRule = computed(() => createPhoneRule())\n\n\t// @ts-ignore\n\tconst validatePolicy = async (_, value: boolean) => {\n\t\treturn !value ? Promise.reject('勾选后才可注册') : Promise.resolve()\n\t}\n\n\t// @ts-ignore\n\tconst validateConfirmPassword = (password: string) => {\n\t\treturn async (_, value: string) => {\n\t\t\tif (!value) {\n\t\t\t\treturn Promise.reject('请输入密码')\n\t\t\t}\n\t\t\tif (value !== password) {\n\t\t\t\treturn Promise.reject('两次输入密码不一致')\n\t\t\t}\n\t\t\treturn Promise.resolve()\n\t\t}\n\t}\n\n\tconst getFormRules = computed(() => {\n\t\tconst passwordFormRule = unref(getPasswordFormRule)\n\t\tconst passwordFormRegRule = unref(getPasswordFormRegRule)\n\t\tconst codeFormRule = unref(getCodeFormRule)\n\t\tconst mobileFormRule = unref(getMobileFormRule)\n\n\t\tswitch (unref(currentState)) {\n\t\t\tcase LoginStateEnum.REGISTER:\n\t\t\t\treturn {\n\t\t\t\t\taccount: mobileFormRule,\n\t\t\t\t\tpassword: passwordFormRegRule\n\t\t\t\t}\n\n\t\t\tcase LoginStateEnum.RESET_PASSWORD:\n\t\t\t\treturn {\n\t\t\t\t\taccount: mobileFormRule\n\t\t\t\t}\n\n\t\t\tcase LoginStateEnum.MOBILE:\n\t\t\t\treturn {\n\t\t\t\t\tcode: codeFormRule,\n\t\t\t\t\taccount: mobileFormRule\n\t\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\treturn {\n\t\t\t\t\taccount: mobileFormRule,\n\t\t\t\t\tpassword: passwordFormRule\n\t\t\t\t}\n\t\t}\n\t})\n\n\treturn { getFormRules }\n}\n\nfunction createRule(message: string) {\n\treturn [\n\t\t{\n\t\t\trequired: true,\n\t\t\tmessage,\n\t\t\ttrigger: 'change'\n\t\t}\n\t]\n}\n\nfunction createPhoneRule() {\n\treturn [\n\t\t{\n\t\t\trequired: true,\n\t\t\tmessage: '请输入用户名',\n\t\t\ttrigger: 'change'\n\t\t}\n\t]\n}\n\nfunction createPasswordRule() {\n\treturn [\n\t\t{\n\t\t\trequired: true,\n\t\t\tmessage: '请输入密码',\n\t\t\ttrigger: 'change'\n\t\t}\n\t]\n}\n","<template>\n\t<div class=\"user-auth\">\n    <el-button type=\"primary\" round @click=\"handleToLogin\">登录</el-button>\n\t</div>\n</template>\n\n<script setup lang=\"ts\">\n\timport { useGo } from '@/hooks/web/usePage'\n\timport { LoginStateEnum, useLoginState } from '@/views/login/useLogin'\n\timport { RouteEnum } from '@/enums/routeEnum'\n\n\tconst go = useGo()\n\tconst { setLoginState } = useLoginState()\n\n\tfunction handleToLogin() {\n\t\tgo(RouteEnum.BASIC_LOGIN + '?callback=' + window.location.href)\n\t}\n\tfunction handleToRegister() {\n\t\tsetLoginState(LoginStateEnum.REGISTER)\n\t\tgo(RouteEnum.BASIC_LOGIN)\n\t}\n</script>\n\n","<template>\n  <div class=\"user-dropdown\">\n    <Dropdown :dropMenuList=\"userMenuList\" @menuEvent=\"handleDropdown\">\n      <el-avatar :src=\"userStore.getUserInfo?.avatar\" class=\"cursor-pointer\" v-loading=\"loading\">\n        <img :src=\"avatarImg\">\n      </el-avatar>\n    </Dropdown>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport {ElAvatar, ElMessage} from 'element-plus'\nimport Dropdown from '@/components/Dropdown/Dropdown.vue'\nimport {DropdownEnum} from '@/enums/dropdownEnum'\nimport {useUserStore} from '@/store/modules/user'\nimport {ref} from 'vue'\nimport {DropMenu} from \"@/components/Dropdown/useDropdown\";\nimport {router} from \"@/router\";\nimport {RouteEnum} from \"@/enums/routeEnum\";\nimport {useTeamStore} from \"@/store/modules/team\";\nimport {MenuValueEnum} from \"@/enums/menuValueEnum\";\nimport {useFiles} from \"@/hooks/components/useFiles\";\nimport avatarImg from '@/assets/images/avatar.png'\n\ninterface Props {\n  nextHandle?: number\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  nextHandle: 0 // nextHandle 0-调回到首页 1-刷新当前页面\n})\n\nconst userMenuList: DropMenu[] = [\n  {\n    icon: 'menu-self-file',\n    iconSize: 20,\n    text: '我的文件',\n    divided: false,\n    key: DropdownEnum.MY_FILE\n  },\n  {\n    icon: 'drop-uc',\n    iconSize: 20,\n    text: '账户中心',\n    divided: true,\n    key: DropdownEnum.USER_CENTER\n  },\n  {\n    icon: 'menu-guid',\n    iconSize: 20,\n    text: '入门教程',\n    divided: false,\n    key: DropdownEnum.GETTING_STARTED\n  },\n  {\n    icon: 'menu-index',\n    iconSize: 20,\n    text: '官网首页',\n    divided: false,\n    key: DropdownEnum.HOME_INDEX\n  },\n  {\n    icon: 'drop-logout',\n    iconSize: 20,\n    text: '退出登录',\n    divided: true,\n    key: DropdownEnum.LOGOUT\n  }\n]\nconst loading = ref<boolean>(false)\nconst userStore = useUserStore()\nconst teamStore = useTeamStore()\nconst {handleFolderMenuChange} = useFiles()\n\nfunction handleDropdown(dropItem) {\n  switch (dropItem.key) {\n    case DropdownEnum.LOGOUT:\n      loading.value = true\n      setTimeout(async () => {\n        await userStore.logout(props.nextHandle || 0)\n        loading.value = false\n      }, 500)\n      break\n    case DropdownEnum.USER_CENTER:\n      router.push(RouteEnum.SETTING)\n      break\n    case DropdownEnum.MY_FILE:\n      goMyFile()\n      break\n    case DropdownEnum.GETTING_STARTED:\n      window.open(RouteEnum.GETTING_STARTED, '_blank')\n      break\n    case DropdownEnum.HOME_INDEX:\n      router.push(RouteEnum.BASIC_ROOT)\n      break\n  }\n}\n\nfunction goMyFile() {\n  router.push(RouteEnum.SELF_FILE)\n\n  let userInfo = userStore.getUserInfo\n  teamStore.setActiveTeamId(userInfo.myTeamId)\n  teamStore.setActiveTeamType('PERSONAL')\n\n  let myFileMenu = {\n    icon: 'menu-self-file',\n    text: '我的文件',\n    value: MenuValueEnum.MY_FILE,\n    spaceId: userInfo.myTeamSpaceId\n  }\n  handleFolderMenuChange(myFileMenu)\n}\n</script>\n","import { useUserStore } from '@/store/modules/user'\r\nimport { computed } from 'vue'\r\n\r\nexport function useUser() {\r\n\tconst userStore = useUserStore()\r\n\tconst hasLogin = computed(() => !!userStore.getToken)\r\n\tconst getUserInfo = computed(() => userStore.getUserInfo)\r\n\r\n\treturn {\r\n\t\thasLogin,\r\n\t\tgetUserInfo\r\n\t}\r\n}\r\n"],"names":["LoginStateEnum","LoginStateEnum2","currentState","ref","useLoginState","setLoginState","state","getLoginState","computed","unref","handleBackLogin","useFormValid","formRef","validForm","__async","form","useFormRules","formData","getPasswordFormRule","createRule","getPasswordFormRegRule","createPasswordRule","getCodeFormRule","getMobileFormRule","createPhoneRule","passwordFormRule","passwordFormRegRule","codeFormRule","mobileFormRule","message","go","useGo","handleToLogin","RouteEnum","props","__props","userMenuList","DropdownEnum","loading","userStore","useUserStore","teamStore","useTeamStore","handleFolderMenuChange","useFiles","handleDropdown","dropItem","router","goMyFile","userInfo","myFileMenu","MenuValueEnum","useUser","hasLogin","getUserInfo"],"mappings":"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"}